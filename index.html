<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ã½ã´ã‚ªãƒ—å¤å‚åˆ¤å®šæ©Ÿ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f7f7fb;
      margin: 0;
      padding: 16px;
      color: #333;
    }

    .container {
      max-width: 420px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 16px;
    }

    .box {
      background: #fff;
      border-radius: 14px;
      padding: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
      margin-bottom: 16px;
    }

    /* ãƒ©ãƒ³ã‚¯èƒŒæ™¯ */
    .bg-å¤å‚ { background: #fff7d6; }
    .bg-æº–å¤å‚ { background: #eef1ff; }
    .bg-ä¸­å‚ { background: #eaf7f1; }
    .bg-æ–°å‚ { background: #f1f1f1; }
    .bg-æ–°è¦ { background: #ecf8ee; }

    label {
      font-weight: bold;
    }

    input, button {
      width: 100%;
      margin-top: 8px;
      padding: 12px;
      font-size: 16px;
      border-radius: 8px;
      box-sizing: border-box; /* â† ã¯ã¿å‡ºã—é˜²æ­¢ */
    }

    input {
      border: 1px solid #ccc;
    }

    button {
      background: #5b7cfa;
      color: white;
      border: none;
      font-weight: bold;
    }

    .result-rank {
      text-align: center;
      font-size: 22px;
    }

    .rank-name {
      font-size: 34px;
      font-weight: 800;
    }

    /* ãƒ©ãƒ³ã‚¯æ–‡å­—è‰² */
    .rank-å¤å‚ { color: #d4a200; }
    .rank-æº–å¤å‚ { color: #4a6cff; }
    .rank-ä¸­å‚ { color: #2fa36b; }
    .rank-æ–°å‚ { color: #888; }
    .rank-æ–°è¦ { color: #7bc96f; }

    .sub {
      text-align: center;
      color: #555;
      margin-top: 6px;
    }

    .celebrate {
      text-align: center;
      font-weight: bold;
      font-size: 18px;
      margin-top: 8px;
    }

    .error {
      color: #d33;
      font-weight: bold;
      text-align: center;
    }
  </style>
</head>
<body>

<div class="container">

<h1>ã½ã´ã‚ªãƒ—å¤å‚åˆ¤å®šæ©Ÿ</h1>

<div class="box">
  <label>å‚åŠ ã—ãŸæ—¥ã‚’å…¥åŠ›ã—ã¦ã­</label>
  <input type="date" id="joinDate">
  <button onclick="judge()">åˆ¤å®šã™ã‚‹ï¼</button>
</div>

<div class="box" id="result" style="display:none;"></div>
<div class="box" id="todayVeteran"></div>

</div>

<script>
const OPEN_DATE = new Date("2023-12-25");

function daysBetween(a, b) {
  return Math.floor((b - a) / 86400000);
}

function findPromotionDate(joinDate, ratioTarget) {
  let d = new Date();
  d.setHours(0,0,0,0);

  for (let i = 0; i < 2000; i++) {
    const total = daysBetween(OPEN_DATE, d) + 1;
    const stay = daysBetween(joinDate, d) + 1;
    if (stay / total >= ratioTarget) return new Date(d);
    d.setDate(d.getDate() + 1);
  }
  return null;
}

function judge() {
  const input = document.getElementById("joinDate").value;
  const result = document.getElementById("result");
  result.style.display = "block";
  result.className = "box";

  if (!input) {
    result.innerHTML = "<div class='error'>æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ã­ï¼</div>";
    return;
  }

  const joinDate = new Date(input);
  const today = new Date();
  today.setHours(0,0,0,0);

  if (joinDate < OPEN_DATE) {
    result.innerHTML = `
      <div class="error">
        å…¥åŠ›ã—ãŸæ—¥ã«ã¡ã®æ™‚ã€ã“ã®ã‚ªãƒ—ã¯å­˜åœ¨ã—ã¦ã„ãªã„ã‚ˆã€‚<br>
        æ­£ç¢ºãªå‚åŠ æ—¥ã‚’æ€ã„å‡ºã—ã¦ï¼
      </div>`;
    return;
  }

  const stayDays = daysBetween(joinDate, today) + 1;
  const totalDays = daysBetween(OPEN_DATE, today) + 1;
  const ratio = stayDays / totalDays;

  let rank, message, nextTarget, nextName;

  if (stayDays <= 7) {
    rank = "æ–°è¦";
    message = "ã‚ˆã†ã“ãï¼ã¾ãšã¯ä¸­å‚ã‚’ç›®æŒ‡ãã†ï¼";
    nextTarget = 0.25;
    nextName = "ä¸­å‚";
  } else if (ratio >= 0.7) {
    rank = "å¤å‚";
    message = "ã“ã‚Œã‹ã‚‰ã‚‚é•·ãã‚ªãƒ—ã«ã„ã¦ã­";
  } else if (ratio >= 0.5) {
    rank = "æº–å¤å‚";
    message = "ã‚‚ã†ä¸€æ¯ã§å¤å‚ï¼";
    nextTarget = 0.7;
    nextName = "å¤å‚";
  } else if (ratio >= 0.25) {
    rank = "ä¸­å‚";
    message = "å°‘ã—ãšã¤æ­´å²ãŒå¢—ãˆã¦ããŸã­ï¼";
    nextTarget = 0.5;
    nextName = "æº–å¤å‚";
  } else {
    rank = "æ–°å‚";
    message = "ã“ã“ã‹ã‚‰ãŒã‚¹ã‚¿ãƒ¼ãƒˆï¼";
    nextTarget = 0.25;
    nextName = "ä¸­å‚";
  }

  result.classList.add(`bg-${rank}`);

  let nextText = "";
  if (nextTarget) {
    const date = findPromotionDate(joinDate, nextTarget);
    const remain = daysBetween(today, date);

    if (remain === 0) {
      nextText = `<div class="celebrate">ğŸ‰ ${nextName}ã«æ˜‡æ ¼ï¼ãŠã‚ã§ã¨ã†ï¼</div>`;
    } else {
      nextText = `
        <div class="sub">
          <span class="highlight">${nextName}</span> ã¾ã§ã‚ã¨
          <span class="highlight">${remain}</span> æ—¥
        </div>`;
    }
  }

  result.innerHTML = `
    <div class="sub">ã‚ãªãŸã®å‚åŠ æ—¥ï¼š${input}</div>
    <div class="result-rank">
      ã‚ãªãŸã¯<br>
      <span class="rank-name rank-${rank}">${rank}</span><br>
      ã§ã™ï¼
    </div>
    <div class="sub">${message}</div>
    ${nextText}
  `;
}

// ä»Šæ—¥å¤å‚ã«ãªã‚‹äºº
(function () {
  const today = new Date();
  today.setHours(0,0,0,0);
  const total = daysBetween(OPEN_DATE, today) + 1;
  const need = Math.ceil(total * 0.7);
  const join = new Date(OPEN_DATE);
  join.setDate(OPEN_DATE.getDate() + total - need);
  document.getElementById("todayVeteran").innerHTML =
    `<b>ä»Šæ—¥ã€å¤å‚ã«ãªã‚‹äººã®å‚åŠ æ—¥</b><br>${join.toISOString().slice(0,10)}`;
})();
</script>

</body>
</html>

